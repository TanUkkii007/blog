Dynamo: Amazon’s Highly Available Key-value Store

http://www.allthingsdistributed.com/2007/10/amazons_dynamo.html

# Abstract

大規模スケールにおいての信頼性はAmazon.com（もっとも大きいeコマースサービス）で直面した大きな課題の１つである。わずかなダウンでも金銭的に大きな結果を引き起こし顧客の信用を低下させる。世界中にWebサービスを提供するAmazon.comプラットフォームは複数のデータセンターの数万のサーバーとネットワークコンポーネントの上に実装されている。このスケールでは、大小のコンポーネントが常に障害を起こし続け、このような障害のもとでどのように永続的な状態を扱うかという手法はソフトウェアシステムに信頼性とスケーラビリティをもたらしてきた。

この論文では、Dynamoのデザインと実装を紹介する。Dynamoは高可用性のあるkey-valueストアで、Amazonの常に利用可能であるという体験を提供しているコアサービスである。このレベルの可用性を実現するには、Dynamoはいくつかの障害の状況で一貫性を犠牲にしている。オブジェクトのバージョニングとアプリケーションが引き起こしたコンフリクトの解決を、開発者が利用しやすい形でふんだんに用いている。

# 1. Introduction

Amazonは世界中のデータセンターにある何十万ものサーバーを使って１０００万ユーザーに提供するeコマースサービスを世界的に展開している。Amazonではプラットフォームがスケールするためにパフォーマンス、信頼性、効率性、に関する厳格なオペレーションの要求がある。なかでも信頼性はもっとも重要な要求の１つである。僅かなダウンが財政と顧客の信頼に影響を与える。

Amazonプラットフォームを運用して学んだ教訓の１つに、信頼性とスケーラビリティはアプリケーションの状態をどのように管理するかにかかっているということがある。Amazonは非中央集権的で疎結合であり、数百のサーバーからなるSOAをつかっている。このような環境では常に利用可能なストレージが必要になる。例えば顧客はディスクが故障していようと、ネットワークが混雑していようと、データセンターが竜巻で破壊されたとしても、ショッピングカートを見たり商品を追加できるべきである。ゆえに、ショッピングカートを担うサービスはデータストアから常に読み書きできればならず、データは複数のデータセンターに存在しなければならない。

百万のコンポーネントからなるインフラストラクチャで障害に対処することは私達のオペレーションの標準となっている。常に小さいながらも莫大な数のサーバーとネットワークコンポーネントがある時間に障害を起こしている。なのでAmazonのソフトウェアシステムは可用性やパフォーマンスに影響をあたえることなく障害を通常のケースとして扱う必要がある。

信頼性とスケーラビリティの要求を叶えるには、Amazonは複数のストレージ技術を開発した。S3が最もよく知られているだろう。この論文ではもう１つの高可用性かつ高スケール性の分散データストアであるDynamoのデザインと実装を紹介する。Dynamoは高信頼性をもちつつ、可用性と整合性、効率性とパフォーマンスのトレードオフが可能なサービスの状態を管理するために使われる。Amazonプラットフォームには異なるストレージ要求の多様なアプリケーションがある。いくつかのアプリケーションはアプリケーションデザイナに高可用性とコスト効率の高いパフォーマンスのトレードオフをもとにデータストアを設定することを求める。

Amazonプラットフォームにはデータストアに主キーのみのデータアクセスしか必要ないサービスがたくさんある。ベストセラーのリスト、ショッピングカート、顧客の好み、セッション管理、セールスランク、商品カタログなどのサービスでは、RDBを使うという一般的なパターンは非効率でスケーラビリティと可用性を制限する。Dynamoはこれらのアプリケーションの要求を満たすシンプルな主キーのみのインターフェースを提供する。

Dynamoはスケーラビリティと可用性を達成するためによく知られた技術を組み合わせている。データはconsistent hashingを使ってパーティションされレプリケーションされる。整合性はオブジェクトのバージョニングで実現する。更新時のレプリカの整合性はクォラムと非中央集権的レプリカ同期技術で担保する。Dynamoはgossipベースのfailure detectionとメンバープロトコルを採用した。Dynamoは最小限の管理ですむ完全に非中央集権的である。ストレージノードは手動のパーティショニングや再分散を必要とせずDynamoから追加削除できる。

過去何年もDynamoはAmazonのいくつかのコアサービスのストレージ技術となってきた。休暇のショッピングシーズンでもダウンタイムなくピークの負荷にスケールできた。例えば、ショッピングカートを担うサービスは１日に３００万の会計に相当する１０００万のリクエストをさばき、セッションサービスは数１０万の同時セッションの状態管理をさばいた。

研究コミュニティの主な貢献は１つの高可用性システムをつくるために異なる技術をどう組み合わせるか評価したことだ。結果整合なストレージシステムは厳しいアプリケーションでもプロダクションで使えることを証明した。プロダクションの厳しいパフォーマンス要求にこたえるためこれらの技術をチューニングする知見も提供した。

この論文は以下のように構成される。２章は背景を説明し、３章は関連する研究を紹介する。４章はシステムデザインを、５章は実装を解説する。６章はプロダクションでのDynamoの運用から得た経験と示唆を詳説し、７章では結論を述べる。この論文の随所でより詳しい解説が適切な場面があるが、Amazonのビジネスを守るために情報を絞った。そのため６章のデータセンター間、内、のレイテンシや、６.２章の絶対リクエスト数やダウンタイム、6.３章の負荷は絶対値ではなく平均を提供している。

# 2. Background
